<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ultra Smooth Neon Snake</title>
<style>
  * {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
  body {
    background:#111;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
    color:#0ff;
  }

  /* Animated Background */
  .animated-bg {
    position:fixed;
    top:0; left:0; width:100%; height:100%;
    background:linear-gradient(120deg,#222,#333,#444,#555);
    background-size:400% 400%;
    animation:moveBg 25s linear infinite;
    z-index:-1;
  }
  @keyframes moveBg {
    0%{background-position:0% 0%;}
    50%{background-position:100% 100%;}
    100%{background-position:0% 0%;}
  }

  /* Game container */
  .game-container {
    position:relative;
    width:90vmin;
    height:90vmin;
    max-width:95vw;
    max-height:70vh;
    border:3px solid #0ff;
    border-radius:15px;
    background:#000;
    overflow:hidden;
    box-shadow:0 0 20px #0ff inset;
  }

  canvas {
    width:100%;
    height:100%;
    border-radius:15px;
    background:#000;
    touch-action:none;
  }

  .score {
    position:absolute;
    top:-2.5rem;
    font-size:1.4rem;
    font-weight:bold;
    text-shadow:0 0 10px #0ff;
  }

  /* Overlay (Game Over + Restart) */
  .overlay {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.8);
    color:#fff;
    font-size:6vw;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    border-radius:15px;
    display:none;
    cursor:pointer;
  }

  .overlay button {
    margin-top:1rem;
    padding:0.8rem 2rem;
    font-size:4vw;
    border:none;
    border-radius:8px;
    background:#0ff;
    color:#000;
    font-weight:bold;
    transition:0.3s;
  }

  .overlay button:hover {
    background:#00d0aa;
  }

  /* Difficulty selection */
  #difficultyScreen {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.9);
    color:#0ff;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    font-size:5vw;
    border-radius:15px;
  }

  #difficultyScreen button {
    margin:0.6rem;
    padding:1rem 2rem;
    font-size:4.5vw;
    border:none;
    border-radius:8px;
    background:#0ff;
    color:#000;
    font-weight:bold;
    transition:0.3s;
  }

  #difficultyScreen button:hover {
    background:#00d0aa;
  }

  /* Touch controls */
  .controls {
    margin-top:2vh;
    display:grid;
    grid-template-areas:
      ". up ."
      "left none right"
      ". down .";
    gap:3vmin;
    justify-items:center;
    align-items:center;
    touch-action:none;
  }

  .control-btn {
    width:16vmin;
    height:16vmin;
    max-width:80px;
    max-height:80px;
    background:#0ff;
    border-radius:50%;
    display:flex;
    justify-content:center;
    align-items:center;
    color:#000;
    font-weight:bold;
    font-size:6vmin;
    user-select:none;
    box-shadow:0 0 10px #0ff;
  }

  .control-btn:active {
    background:#00d0aa;
  }

  #up { grid-area: up; }
  #down { grid-area: down; }
  #left { grid-area: left; }
  #right { grid-area: right; }

  @media (min-width:768px) {
    .controls {display:none;} /* Hide touch buttons on PC */
    .score {font-size:1.6rem;}
  }
</style>
</head>
<body>
<div class="animated-bg"></div>

<div class="game-container">
  <div class="score">Score: 0</div>
  <canvas id="gameCanvas"></canvas>

  <div class="overlay" id="gameOver">
    <div>Game Over!</div>
    <button onclick="restartGame()">Restart</button>
  </div>

  <div id="difficultyScreen">
    <div>Select Difficulty</div>
    <button onclick="startGame('Easy')">Easy</button>
    <button onclick="startGame('Medium')">Medium</button>
    <button onclick="startGame('Hard')">Hard</button>
  </div>
</div>

<!-- Mobile Controls -->
<div class="controls">
  <div class="control-btn" id="up">↑</div>
  <div class="control-btn" id="left">←</div>
  <div class="control-btn" id="down">↓</div>
  <div class="control-btn" id="right">→</div>
</div>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const overlay=document.getElementById('gameOver');
const scoreDisplay=document.querySelector('.score');
const difficultyScreen=document.getElementById('difficultyScreen');

let box, snake=[], food, direction, score, speed, lastTime=0, moveAccumulator=0;

// Beep sound when eating
const audioCtx = new (window.AudioContext||window.webkitAudioContext)();
function playBeep(freq=600,duration=0.1,vol=0.15){
  const osc=audioCtx.createOscillator();
  const gain=audioCtx.createGain();
  osc.frequency.value=freq;
  osc.type='sine';
  gain.gain.value=vol;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+duration);
}

// Resize canvas to fit
function resizeCanvas(){
  let size=Math.min(window.innerWidth*0.9,window.innerHeight*0.7);
  canvas.width=size;
  canvas.height=size;
  box=Math.floor(size/25);
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

function startGame(level){
  difficultyScreen.style.display='none';
  if(level==='Easy') speed=150;
  if(level==='Medium') speed=100;
  if(level==='Hard') speed=70;
  initGame();
}

function initGame(){
  snake=[{x:5*box,y:5*box}];
  direction='RIGHT';
  score=0;
  scoreDisplay.textContent='Score: 0';
  food=spawnFood();
  overlay.style.display='none';
  lastTime=0;
  moveAccumulator=0;
  requestAnimationFrame(gameLoop);
}

function spawnFood(){
  let newFood;
  do{
    newFood={x:Math.floor(Math.random()*(canvas.width/box))*box,
             y:Math.floor(Math.random()*(canvas.height/box))*box};
  }while(snake.some(seg=>seg.x===newFood.x&&seg.y===newFood.y));
  return newFood;
}

function draw(){
  ctx.fillStyle='#000';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Snake
  snake.forEach((seg)=>{
    let grad=ctx.createLinearGradient(seg.x,seg.y,seg.x+box,seg.y+box);
    grad.addColorStop(0,'#0cc'); grad.addColorStop(1,'#00f');
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(seg.x+box/2,seg.y+box/2,box/2,0,Math.PI*2);
    ctx.fill();
  });

  // Head glow
  let head=snake[0];
  ctx.fillStyle='#0ff';
  ctx.shadowColor='#0ff';
  ctx.shadowBlur=20;
  ctx.beginPath();
  ctx.arc(head.x+box/2,head.y+box/2,box/2,0,Math.PI*2);
  ctx.fill();
  ctx.shadowBlur=0;

  // Food
  let fGrad=ctx.createRadialGradient(food.x+box/2,food.y+box/2,2,food.x+box/2,food.y+box/2,box);
  fGrad.addColorStop(0,'#f0f');
  fGrad.addColorStop(1,'rgba(255,0,255,0)');
  ctx.fillStyle=fGrad;
  ctx.shadowColor='#f0f';
  ctx.shadowBlur=15;
  ctx.beginPath();
  ctx.arc(food.x+box/2,food.y+box/2,box/2,0,Math.PI*2);
  ctx.fill();
  ctx.shadowBlur=0;
}

function update(deltaTime){
  moveAccumulator+=deltaTime;
  if(moveAccumulator>=speed){
    moveSnake();
    moveAccumulator=0;
  }
}

function moveSnake(){
  let head={x:snake[0].x,y:snake[0].y};
  if(direction==='LEFT') head.x-=box;
  if(direction==='RIGHT') head.x+=box;
  if(direction==='UP') head.y-=box;
  if(direction==='DOWN') head.y+=box;

  // Collision
  if(head.x<0||head.x>=canvas.width||head.y<0||head.y>=canvas.height||
     snake.some(seg=>seg.x===head.x&&seg.y===head.y)){
    gameOver(); return;
  }

  snake.unshift(head);

  // Eat
  if(head.x===food.x&&head.y===food.y){
    score+=10;
    scoreDisplay.textContent='Score: '+score;
    food=spawnFood();
    playBeep();
  } else {
    snake.pop();
  }
}

function gameLoop(timestamp){
  if(!lastTime) lastTime=timestamp;
  let deltaTime=timestamp-lastTime;
  lastTime=timestamp;
  update(deltaTime);
  draw();
  requestAnimationFrame(gameLoop);
}

function gameOver(){
  overlay.style.display='flex';
}
overlay.addEventListener('click',restartGame);

function restartGame(){
  difficultyScreen.style.display='flex';
  overlay.style.display='none';
}

// PC Controls
document.addEventListener('keydown',e=>{
  if((e.key==='ArrowLeft'||e.key==='a')&&direction!=='RIGHT') direction='LEFT';
  if((e.key==='ArrowRight'||e.key==='d')&&direction!=='LEFT') direction='RIGHT';
  if((e.key==='ArrowUp'||e.key==='w')&&direction!=='DOWN') direction='UP';
  if((e.key==='ArrowDown'||e.key==='s')&&direction!=='UP') direction='DOWN';
});

// Touch controls
const dirs={up:'UP',down:'DOWN',left:'LEFT',right:'RIGHT'};
for(let d in dirs){
  document.getElementById(d).addEventListener('touchstart',()=>{
    if(dirs[d]==='LEFT' && direction!=='RIGHT') direction='LEFT';
    if(dirs[d]==='RIGHT' && direction!=='LEFT') direction='RIGHT';
    if(dirs[d]==='UP' && direction!=='DOWN') direction='UP';
    if(dirs[d]==='DOWN' && direction!=='UP') direction='DOWN';
  });
}

// Swipe gestures
let startX=0,startY=0;
canvas.addEventListener('touchstart',e=>{
  const t=e.touches[0];
  startX=t.clientX; startY=t.clientY;
});
canvas.addEventListener('touchend',e=>{
  const t=e.changedTouches[0];
  let dx=t.clientX-startX, dy=t.clientY-startY;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>30 && direction!=='LEFT') direction='RIGHT';
    else if(dx<-30 && direction!=='RIGHT') direction='LEFT';
  } else {
    if(dy>30 && direction!=='UP') direction='DOWN';
    else if(dy<-30 && direction!=='DOWN') direction='UP';
  }
});
</script>
</body>
</html>
